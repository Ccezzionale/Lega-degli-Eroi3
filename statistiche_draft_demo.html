
<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Statistiche Draft - Lega degli Eroi</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #001f3f;
      color: #fff;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #ffcc00;
      margin-bottom: 20px;
    }
    section {
      margin-bottom: 40px;
    }
    table {
      width: 100%;
      background: #fff;
      color: #000;
      border-collapse: collapse;
      border-radius: 8px;
      overflow: hidden;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #003366;
      color: white;
    }
  </style>
</head>
<body>
  <h1>Statistiche Draft - Lega degli Eroi</h1>

  <button onclick="aggiornaStatistiche()">üîÅ Aggiorna Statistiche</button>

  <section>
    <h2>Pick per Squadra</h2>
    <table id="pick-per-squadra">
      <thead><tr><th>Squadra</th><th>Pick Effettuate</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h2>Pick per Ruolo</h2>
    <table id="pick-per-ruolo">
      <thead><tr><th>Ruolo</th><th>Pick Effettuate</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <section>
    <h2>Ultime 3 Pick</h2>
    <table id="ultime-pick">
      <thead><tr><th>Pick</th><th>Squadra</th><th>Giocatore</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>

  <script>
    async function aggiornaStatistiche() {
      const response = await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vTDKKMarxp0Kl7kiIWa-1X7jB-54KcQaLIGArN1FfR_X40rwAKVRgUYRGhrzIJ7SsKtUPnk_Cz8F0qt/pub?output=csv");
      const testo = await response.text();
      const righe = testo.trim().split(/\r?\n/).slice(1);
      const pickData = [];

      righe.forEach(riga => {
        const colonne = riga.match(/(".*?"|[^",]+)(?=,|$)/g)?.map(c => c.replace(/^"|"$/g, ""));
        if (colonne && colonne.length >= 3 && colonne[2].trim() !== "") {
          pickData.push({ pick: colonne[0], squadra: colonne[1], giocatore: colonne[2] });
        }
      });

      // Pick per squadra
      const squadreMap = {};
      pickData.forEach(p => {
        squadreMap[p.squadra] = (squadreMap[p.squadra] || 0) + 1;
      });

      const tbodySquadre = document.querySelector("#pick-per-squadra tbody");
      tbodySquadre.innerHTML = "";
      Object.entries(squadreMap).forEach(([squadra, count]) => {
        tbodySquadre.innerHTML += `<tr><td>${squadra}</td><td>${count}</td></tr>`;
      });

      // Pick per ruolo (basato su file CSV dei giocatori 2024)
      const responseRuoli = await fetch("giocatori_2024_base.csv");
      const textRuoli = await responseRuoli.text();
      const righeRuoli = textRuoli.trim().split(/\r?\n/).slice(1);
      const ruoloMap = {};
      const ruoloLookup = {};

      righeRuoli.forEach(r => {
        const [nome, ruolo] = r.split(",").map(c => c.trim().replace(/^"|"$/g, ""));
        if (nome) ruoloLookup[nome.toLowerCase()] = ruolo;
      });

      pickData.forEach(p => {
        const ruolo = ruoloLookup[p.giocatore.toLowerCase()] || "N/D";
        ruoloMap[ruolo] = (ruoloMap[ruolo] || 0) + 1;
      });

      const tbodyRuoli = document.querySelector("#pick-per-ruolo tbody");
      tbodyRuoli.innerHTML = "";
      Object.entries(ruoloMap).forEach(([ruolo, count]) => {
        tbodyRuoli.innerHTML += `<tr><td>${ruolo}</td><td>${count}</td></tr>`;
      });

      // Ultime 3 pick
      const ultime = pickData.slice(-3).reverse();
      const tbodyUltime = document.querySelector("#ultime-pick tbody");
      tbodyUltime.innerHTML = "";
      ultime.forEach(p => {
        tbodyUltime.innerHTML += `<tr><td>${p.pick}</td><td>${p.squadra}</td><td>${p.giocatore}</td></tr>`;
      });
    }

    aggiornaStatistiche();
  </script>
</body>
</html>
